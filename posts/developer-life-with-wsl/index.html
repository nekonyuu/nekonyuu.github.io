<!doctype html><html lang=en><head><title>Switching to Windows with WSL - Jonathan Raffre</title><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="In January 2019 I prepared myself for the big jump as a freelancer and one of the first questions was &#34;Which laptop should I buy for my activity ?&#34;, as I'd need one of my own.

I wouldn't have thought I'd go to Windows, at that time."><link href="https://fonts.googleapis.com/css?family=Lora:400,400i,700,700i&display=swap" rel=stylesheet><link rel=stylesheet href=/assets/css/main.css></head><body><div id=page class="site palette-red"><header id=masthead class=site-header><div id=header-bg class=site-header-bg style=background-image:url(/images/20200921-surfacebook2.jpg)></div><div class=site-header-scroll><div class=site-header-inside><div class=site-header-vertical><div class=site-branding><p class=site-title><a href=/>Jonathan Raffre</a></p><p class=site-description>Ramblings of a Jack of All Trades.</p></div><nav id=main-navigation class=site-navigation aria-label="Main Navigation"><div class=site-nav-wrap><div class=site-nav-inside><ul class=menu><li class="menu-item current-menu-item"><a href=/>Home</a></li><li class=menu-item><a href=/about/>About</a></li><li class=menu-item><a href=/contact/>Contact</a></li></ul><div class=social-links><a class=button-circle href=https://twitter.com/nekonyuu42 target=_blank rel=noopener><span class="fab fa-twitter" aria-hidden=true></span><span class=screen-reader-text>Twitter</span></a>
<a class=button-circle href=https://github.com/nekonyuu target=_blank rel=noopener><span class="fab fa-github" aria-hidden=true></span><span class=screen-reader-text>GitHub</span></a>
<a class=button-circle href=https://www.linkedin.com/jonathan.raffre target=_blank rel=noopener><span class="fab fa-linkedin" aria-hidden=true></span><span class=screen-reader-text>LinkedIn</span></a></div></div></div></nav><button id=menu-toggle class=menu-toggle><span class=screen-reader-text>Menu</span><span class=icon-menu aria-hidden=true></span></button></div></div></div></header><div id=content class=site-content><main id=main class="site-main inner"><article class="post post-full"><header class=post-header><h1 class=post-title>Switching to Windows with WSL</h1><div class=post-meta>Published on <time class=published datetime="2020-09-21 22:00">September 21, 2020</time></div></header><div class=post-content><h2 id=why-did-i-leave-linux-desktop>Why did I leave Linux Desktop</h2><p>In January 2019 I prepared myself for the big jump as a freelancer and one of the first questions was &ldquo;Which laptop should I buy for my activity ?&rdquo;, as I&rsquo;d need one of my own.</p><p>My list of requirements placed the bar a bit high :</p><ul><li>nice battery life (over 8h under IntelliJ)</li><li>good amount of RAM ;</li><li>have an NVidia GPU for CUDA usage ;</li><li>stylus friendly (to be actually able to draw things and take note on it) ;</li><li>Under 2.5 kilograms ;</li><li>Linux-compatible.</li></ul><p>If you do not know, finding a laptop fully working with Linux is hard, especially when most powerful laptops have a discrete NVidia GPU alongside the Intel one (hybrid graphics called Optimus). In most cases, Optimus is badly supported and either keeps the discrete GPU on, eating your battery, or makes it complicated to use it because of having to reload X server to switch to it.</p><p>Having a hard time finding the right workstation, I asked myself if I really wanted to limit myself to Linux. One option was Mac OS X, but there&rsquo;s no stylus-friendly laptop and I&rsquo;ve got kind of a bad feeling with it UX wise, so that one&rsquo;s out. The other option was Windows, and Microsoft announced WSL years ago as well as Windows Terminal in the works.</p><p>All those moves from Microsoft appealed to my curiosity, so I wanted to see for myself what all of this is about : I ended up taking something from the Surface line, the Surface Book 2.</p><h2 id=windows-subsystem-for-linux>Windows Subsystem for Linux</h2><h3 id=the-genesis>The genesis</h3><p>Windows Subsystem for Linux (WSL), in its first version, is a translation layer, a bit like Cygwin but smarter and without binary re-linkage needed. This means that, in theory, <em>any</em> native ELF64 binary does run in WSL, without any modification !</p><p><img src=/images/20200921-winshellwsl.png alt></p><p>In truth, though, it does not emulate advanced system call or kernel feature, like those needed for Docker (cgroups, namespaces, …). This didn&rsquo;t hamper me much, but being an emulation layer, although CPU performance was good, I/O were slow, like, <em>really slow</em>. This made WSL1 not that usable with Python, Scala or JavaScript projects in the end, being pretty heavy on I/Os.</p><p><em>If you&rsquo;re curious about how WSL1 works under the hood, you can check out one of the official blog posts about it</em> <a href=https://blogs.msdn.microsoft.com/wsl/2016/04/22/windows-subsystem-for-linux-overview/><em>at Microsoft</em></a> <em>or</em> <a href=%22https://blog.jessfraz.com/post/windows-for-linux-nerds/%22><em>the nice explanation from Jessie Frazzele</em></a><em>.</em></p><h3 id=wsl2-100-better>WSL2, 100% better</h3><p>After that, on May 2019, Microsoft announced they were working on a 2nd iteration of WSL, which would use a lightweight VM tightly integrated with Windows and would be soon available to Insiders community.</p><p>I&rsquo;ve switched to it as soon as it got on the Insiders channels, as I/O performance was announced to be way better, which it was, and made it actually possible to use it for development purpose, or, well, use it like any native Linux !</p><p>Now, since May 2020, it&rsquo;s available natively in the May 2020 Update of Windows 10.</p><h2 id=installing-wsl>Installing WSL</h2><p>As WSL currently still defaults to WSL1 for compatibility reasons, you&rsquo;ll have to install WSL and, after installing necessary features for virtualization, set the default version of WSL to 2 if you want to use it.</p><p>Whichever you choose, the distribution setup stays the same. Let&rsquo;s see then for WSL 2 !</p><p>First, open a Powershell as Admin and run this to enable WSL :</p><pre><code>dism.exe /online /enable-feature /featurename:Microsoft-Windows-Subsystem-Linux /all /norestart
</code></pre><p>Then, if you want WSL2, run also this to enable Hyper-V for virtualization support:</p><pre><code>dism.exe /online /enable-feature /featurename:VirtualMachinePlatform /all /norestart
</code></pre><p>Now, reboot, and if you chose WSL2, open back a Powershell as Admin and run the following to change WSL default version</p><pre><code>wsl --set-default-version 2
</code></pre><p>You are now ready to install a Linux distribution.</p><h2 id=installing-a-distro>Installing a distro</h2><p>Microsoft and editors done a pretty nice job at packaging distributions : you&rsquo;ve got on the store Ubuntu, Kali, Debian, Alpine, OpenSUSE… which are all one click away ! Just search for WSL in the store, install one, run it from the start menu then you&rsquo;re greeted with an invite asking the username and password you&rsquo;d like, then it&rsquo;s ready to go.</p><p>In order to get a better shell experience, first, search for Windows Terminal from the store and install it, you&rsquo;ll get near-Linux-like terminal emulator experience :).</p><p>Now, let&rsquo;s try installing one, for example Debian. Search for it on the Store, hit Install, then once it&rsquo;s ready, open your new Windows Terminal and run:</p><pre><code>nekon@ASANA $ debian
Installing, this may take a few minutes...
Please create a default UNIX user account. The username does not need to match your Windows username.
For more information visit: https://aka.ms/wslusers
Enter new UNIX username:
</code></pre><p>You&rsquo;re greeted with an invite asking you for a chosen username, then a password, aaaand:</p><p><img src=/images/20200922-shell-debian.png alt title="Linux has breached into Windows"></p><p>Now, you may do whatever you want inside your new environment, as if it was a fresh Linux install, minus the desktop environment, as you&rsquo;ve got Windows' one already.</p><h2 id=getting-in-and-out-of-wsl>Getting in-and-out of WSL</h2><p>First, check the + sign near the shell tab of Windows Terminal and see for yourself :</p><p><img src=/images/20200922-windows-term-wsl.png alt></p><p>You can start any of your distributions from there, which get you right in the chosen one, or you can do the following in a PowerShell session :</p><pre><code>$ wsl -l -v
  NAME                   STATE           VERSION
* Ubuntu-20.04           Running         2
  Debian                 Stopped         2
 $ wsl -d Debian
 nk@Asana:/mnt/c/Users/nekon$
</code></pre><p>Your disks are also available, as you can see when entering WSL, under /mnt, which allows you to freely access files from Windows under Linux.</p><h2 id=wrapping-up>Wrapping up</h2><p>Using WSL allowed me in the end to check all my requirements, while still having a Linux environment available on-demand and not too heavy on resources, hence why I&rsquo;m staying currently with this setup. I&rsquo;m also able to <a href=https://developer.nvidia.com/cuda/wsl>use the NVidia GPU for ML tasks also in WSL</a> without killing my battery.</p><p>I won&rsquo;t say Windows doesn&rsquo;t have quirks, but so far, I&rsquo;m fine with it being my daily driver since January 2019.</p></div></article></main><footer id=colophon class="site-footer inner"><div class=site-footer-inside><span class=copyright>&copy; All rights reserved.</span></div><a id=to-top class=to-top href=#page>To top <span class=icon-arrow-up aria-hidden=true></span></a></footer></div></div><script src=/assets/js/plugins.js></script><script src=/assets/js/main.js></script></body></html>